import time
import board
import adafruit_dht
import RPi.GPIO as GPIO


GPIO.setmode(GPIO.BCM)


RED_PIN = 22
YELLOW_PIN = 27
GREEN_PIN = 17


GPIO.setup(RED_PIN, GPIO.OUT)
GPIO.setup(YELLOW_PIN, GPIO.OUT)
GPIO.setup(GREEN_PIN, GPIO.OUT)


dht_device = adafruit_dht.DHT11(board.D4)

def all_leds_off():
    GPIO.output(RED_PIN, GPIO.LOW)
    GPIO.output(YELLOW_PIN, GPIO.LOW)
    GPIO.output(GREEN_PIN, GPIO.LOW)

def glowRedLed():
    all_leds_off()
    GPIO.output(RED_PIN, GPIO.HIGH)

def glowYellowLed():
    all_leds_off()
    GPIO.output(YELLOW_PIN, GPIO.HIGH)

def glowGreenLed():
    all_leds_off()
    GPIO.output(GREEN_PIN, GPIO.HIGH)


try:
    while True:
        try:
            temperature = dht_device.temperature
            humidity = dht_device.humidity

            if temperature is not None and humidity is not None:
                print(f"Temp: {temperature}Â°C    Humidity: {humidity}%")

                if temperature > 34:
                    glowGreenLed()
                elif 29 < temperature <= 34:

                    glowYellowLed()
                else:  
                    glowRedLed()
            else:
                print("Failed to retrieve data from sensor")

        except RuntimeError as error:
            print(f"Sensor error: {error}")

        time.sleep(2)

except KeyboardInterrupt:
    print("Exiting program...")

finally:
    dht_device.exit()
    all_leds_off()
    GPIO.cleanup()

